package com.project.PatientService.service;
import java.util.List;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.project.PatientService.DTO.AppointmentDTO;
import com.project.PatientService.entities.Appointment;
import com.project.PatientService.repositories.AppointmentRepository;

@Service
public class AppointmentServiceImpl implements AppointmentService{
	
	@Autowired
	private AppointmentRepository appointmentRepository;
	
	@Override
	public List<AppointmentDTO> getAllAppointment() {
		
		return appointmentRepository.findAll()
                .stream()
                .map(this::convertToDTO)
                .collect(Collectors.toList());
	}

	@Override
	public List<AppointmentDTO> getAppointmentByDoctorId(int doctorId) {
		// TODO Auto-generated method stub
		return appointmentRepository.findByDoctorId(doctorId)
                .stream()
                .map(this::convertToDTO)
                .collect(Collectors.toList());
	}

	@Override
	public List<AppointmentDTO> getAppointmentByPatientId(int patientId) {
		// TODO Auto-generated method stub
		return appointmentRepository.findByPatientId(patientId)
                .stream()
                .map(this::convertToDTO)
                .collect(Collectors.toList());
	}

	@Override
	public AppointmentDTO getAppointmentById(int appointmentId) {
		// TODO Auto-generated method stub
		Appointment appointment = appointmentRepository.findById(appointmentId)
                .orElseThrow(() -> new RuntimeException("Appointment not found with ID: " + appointmentId));

        return convertToDTO(appointment);
	}

	private AppointmentDTO convertToDTO(Appointment appointment) {
        return new AppointmentDTO(
                appointment.getAppointmentId(),
                appointment.getPatientId(),
                appointment.getDoctorId(),
                appointment.getSpecialization(),
                appointment.getAppointmentDetails(),
                appointment.getLastPrescription(),
                appointment.getStatus(),
                appointment.getCreatedOn(),
                appointment.getScheduledFor()
        );
    }
}
