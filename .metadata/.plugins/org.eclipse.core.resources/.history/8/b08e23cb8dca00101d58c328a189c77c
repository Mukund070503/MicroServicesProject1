package com.project.PatientService.client;

import com.project.PatientService.DTO.*;

import lombok.RequiredArgsConstructor;

import org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration;
import org.springframework.stereotype.Component;
import org.springframework.web.reactive.function.client.WebClient;

import java.util.List;

@Component
@RequiredArgsConstructor
public class VisitServiceClient {

	private final WebClient visitWebClient;

    // Book visit
    public Object bookVisit(BookVisitDTO dto) {
        return visitWebClient.post()
                .uri("/api/visits/book")
                .bodyValue(dto)
                .retrieve()
                .bodyToMono(Object.class)
                .block();
    }

    // Upcoming visits for patient
    public List<VisitHistoryDTO> getUpcomingVisits(Long patientId) {
        return visitWebClient.get()
                .uri("/api/visits/patient/{id}/upcoming", patientId)
                .retrieve()
                .bodyToFlux(VisitHistoryDTO.class)
                .collectList()
                .block();
    }

    // Visit history
    public List<VisitHistoryDTO> getVisitHistory(Long patientId) {
        return visitWebClient.get()
                .uri("/api/visits/patient/{id}/history", patientId)
                .retrieve()
                .bodyToFlux(VisitHistoryDTO.class)
                .collectList()
                .block();
    }

    // Visit details
    public VisitDetailsDTO getVisitDetails(Long visitId) {
        return visitWebClient.get()
                .uri("/api/visits/{visitId}/details", visitId)
                .retrieve()
                .bodyToMono(VisitDetailsDTO.class)
                .block();
    }
}
